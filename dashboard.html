<!DOCTYPE html>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		<script>
			var HOSTNAME = 'https://backend.lmbutler-ssa.net';

			var clientToken="";

			$(window).load(function(){$(document).ready(function(){
				document.getElementById("dataSelector").selectedIndex = -1;
				var requestClientTokenUrl = HOSTNAME + "/dashboard?is_request_clientToken=true";
				$.ajax({
					url: requestClientTokenUrl,
					data: null,
					success: function(resp) {
						clientToken    =   resp;
						console.log(clientToken);
					},
					error: function(jqXHR, textStatus, errorThrown)
					{
						console.log(errorThrown);
						var redirectUrl = HOSTNAME + "/login";
						window.location = redirectUrl;
					},
					dataType: "text"
				});
			});});

			function showData()
			{
				var tableSelect=document.getElementById("dataSelector");
				var sortSelect=document.getElementById("sortCriteria");
				var selectedValue = tableSelect.options[tableSelect.selectedIndex].value;
				console.log(selectedValue);
				var requestUrl = HOSTNAME + "/"+selectedValue+"?client_access_token="+clientToken + '&sort_by={"'+sortSelect+'":"ASC"}';
				console.log(requestUrl);
				$.ajax({
					url: requestUrl,
					data: null,
					success: function(resp) {
						console.log(resp);
						//var formattedStr = JSON.stringify(resp, null, "\t");
						//$("#dataHolder").text(formattedStr);
						//$('#dataHolder').html(resp);
						$("#dataHolder").html(JSON.stringify($.parseJSON(resp),null,4));
						//$("#data")
					},
					error: function(jqXHR, textStatus, errorThrown)
					{
						console.log(jqXHR);
						console.log($.parseJSON(jqXHR.responseText)["errormsg"]);
						$("#dataHolder").html($.parseJSON(jqXHR.responseText)["errormsg"]);
					},
					dataType: "text"
				});
			}

			function signOut()
			{
				var redirectUrl = HOSTNAME + "/login?is_sign_out=true";
				window.location = redirectUrl;
			}

			function showAlert() {
				alert("Coming soon...");
			}
		</script>
	</head>
	<body>
		<table cellpadding="5">
		  <tr>
			<td><button type="button" onClick='showAlert()'>Generate Report</button></td>
			<td>
				<span>Table: </span>
				<select id="dataSelector" onchange="showData()">
				  <option value="clients">clients</option>
				  <option value="health_pages">healthPages</option>
				  <option value="health_selects">healthSelects</option>
				  <option value="health_themes">healthThemes</option>
				  <option value="health_topics">healthTopics</option>
				  <option value="households">households</option>
				  <option value="page_assessment1">pageAssessment1</option>
				  <option value="page_select1">pageSelect1</option>
				  <option value="page_text1">pageText1</option>
				  <option value="page_video1">pageVideo1</option>
				  <option value="resources">resources</option>
				  <option value="services">services</option>
				  <option value="topic_videos">topicVideos</option>
				  <option value="vaccines">vaccines</option>
				  <option value="videos">videos</option>
				  <option value="visits">visits</option>
				  <option value="workers">workers</option>
				</select>
			</td>
			<td>
				<span>Sort by: </span>
				<select id="sortCriteria" onchange="showData()">
				  <option value="_id">id</option>
				  <option value="created_at">created_at</option>
				  <option value="modified_at">modified_at</option>
				</select>
			</td>
			<td><button type="button" onClick='signOut();'>Sign Out</button></td>
		  </tr>
		  <tr>
			<td colspan="2">
				<pre id="dataHolder" style="word-wrap: break-word; white-space: pre-wrap;"></pre>
			</td>
		  </tr>
		</table>
	</body>
</html>
